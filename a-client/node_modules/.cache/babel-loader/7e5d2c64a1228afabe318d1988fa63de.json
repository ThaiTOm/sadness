{"ast":null,"code":"import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import _toConsumableArray from\"/home/duythai/Developer/sadness/a-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import _slicedToArray from\"/home/duythai/Developer/sadness/a-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef}from'react';import{FormSend,messageLiImageRender,messageLiRender}from'../../helpers/message';import{decryptWithAES}from'../../helpers/auth';import axios from'axios';import socketApp from'../../socket';import{executeScroll}from\"../../helpers/message\";function RenderChat(props){var socket=socketApp.getSocket();var id=props.id,userId=props.userId;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),msg=_useState2[0],setMsg=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),load=_useState4[0],setLoad=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),start=_useState6[0],setStart=_useState6[1];var _useState7=useState(30),_useState8=_slicedToArray(_useState7,2),end=_useState8[0],setEnd=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),render=_useState10[0],setRender=_useState10[1];var myRef=useRef(null);var handleClickLoad=function handleClickLoad(){setLoad(true);setTimeout(function(){setEnd(end+10);},1000);};useEffect(function(){axios.get(\"http://localhost:2704/api/msgC/sendContact?id=\"+id+\"&start=\"+start+\"&end=\"+end).then(function(res){setMsg(res.data.data);setLoad(false);}).catch(function(err){return/*#__PURE__*/_jsx(\"div\",{children:\"Oops, b\\u1EA1n h\\xE3y th\\u1EED l\\u1EA1i sau\"});});},[id,start,end]);var func=function func(msg){if(msg.image)setMsg(function(img){return[].concat(_toConsumableArray(img),[msg.image]);});else setMsg(function(msgs){return[].concat(_toConsumableArray(msgs),[msg.data]);});executeScroll(myRef);};useEffect(function(){var fnc=function fnc(value){socket.once(\"message\",function(msg){setRender(msg);return msg.idRoom===value&&func(msg);});};fnc(id);},[id,socket,render]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"button_load_more\",children:load===false?/*#__PURE__*/_jsx(\"button\",{onClick:handleClickLoad,children:\"T\\u1EA3i th\\xEAm\"}):/*#__PURE__*/_jsxs(\"div\",{className:\"loaderBalls\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"yellow\"}),/*#__PURE__*/_jsx(\"div\",{className:\"red\"}),/*#__PURE__*/_jsx(\"div\",{className:\"blue\"})]})}),msg.length>0?msg.map(function(item,i){console.log(item);if(item.image){var imgUrl=item.image;if(item.id===userId)return messageLiImageRender(\"mIOwn\",i,imgUrl,myRef);else return messageLiImageRender(\"mIOther\",i,imgUrl,myRef);}else{var msgs=item.data[0]?decryptWithAES(item.data[0]):\"\";if(item.id===userId)return messageLiRender(\"messageLiOwn\",\"own_message_same_div messageLiOwnm60\",\"own_message_same_div messageLiOwnl60\",msgs,i,myRef);else return messageLiRender(\"messageLiOther\",\"other_message_same_div messageLiOtherm60\",\"other_message_same_div messageLiOtherl60\",msgs,i,myRef);}}):console.log()]}),/*#__PURE__*/_jsx(FormSend,{id:id,userId:userId})]});}export default RenderChat;","map":{"version":3,"sources":["/home/duythai/Developer/sadness/a-client/src/component/chatComponent/renderChat.js"],"names":["React","useState","useEffect","useRef","FormSend","messageLiImageRender","messageLiRender","decryptWithAES","axios","socketApp","executeScroll","RenderChat","props","socket","getSocket","id","userId","msg","setMsg","load","setLoad","start","setStart","end","setEnd","render","setRender","myRef","handleClickLoad","setTimeout","get","then","res","data","catch","err","func","image","img","msgs","fnc","value","once","idRoom","length","map","item","i","console","log","imgUrl"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react'\nimport { FormSend, messageLiImageRender, messageLiRender } from '../../helpers/message';\nimport { decryptWithAES } from '../../helpers/auth';\nimport axios from 'axios';\nimport socketApp from '../../socket';\nimport { executeScroll } from \"../../helpers/message\"\n\n\nfunction RenderChat(props) {\n    let socket = socketApp.getSocket();\n    let { id, userId } = props\n    const [msg, setMsg] = useState([]);\n    const [load, setLoad] = useState(false);\n    const [start, setStart] = useState(0);\n    const [end, setEnd] = useState(30);\n    const [render, setRender] = useState(null)\n    const myRef = useRef(null);\n\n    const handleClickLoad = () => {\n        setLoad(true);\n        setTimeout(() => {\n            setEnd(end + 10)\n        }, 1000)\n    }\n    useEffect(() => {\n        axios.get(\"http://localhost:2704/api/msgC/sendContact?id=\" + id + \"&start=\" + start + \"&end=\" + end)\n            .then(res => {\n                setMsg(res.data.data)\n                setLoad(false)\n            }).catch(err => {\n                return <div>Oops, bạn hãy thử lại sau</div>\n            })\n    }, [id, start, end])\n    let func = (msg) => {\n        if (msg.image) setMsg(img => [...img, msg.image])\n        else setMsg(msgs => [...msgs, msg.data])\n        executeScroll(myRef)\n    }\n\n    useEffect(() => {\n        let fnc = (value) => {\n            socket.once(\"message\", msg => {\n                setRender(msg)\n                return msg.idRoom === value && func(msg)\n            })\n        }\n        fnc(id)\n    }, [id, socket, render])\n    return (\n        <>\n            <ul>\n                <div className=\"button_load_more\">\n                    {load === false ? <button onClick={handleClickLoad}>Tải thêm</button>\n                        : <div className=\"loaderBalls\">\n                            <div className=\"yellow\"></div>\n                            <div className=\"red\"></div>\n                            <div className=\"blue\"></div>\n                        </div>\n                    }\n                </div>\n                {\n                    msg.length > 0 ?\n                        msg.map(function (item, i) {\n                            console.log(item)\n                            if (item.image) {\n                                let imgUrl = item.image\n                                if (item.id === userId) return messageLiImageRender(\"mIOwn\", i, imgUrl, myRef)\n                                else return messageLiImageRender(\"mIOther\", i, imgUrl, myRef)\n                            } else {\n                                let msgs = item.data[0] ? decryptWithAES(item.data[0]) : \"\"\n                                if (item.id === userId) return messageLiRender(\"messageLiOwn\", \"own_message_same_div messageLiOwnm60\", \"own_message_same_div messageLiOwnl60\", msgs, i, myRef)\n                                else return messageLiRender(\"messageLiOther\", \"other_message_same_div messageLiOtherm60\", \"other_message_same_div messageLiOtherl60\", msgs, i, myRef)\n                            }\n                        }) : console.log()\n                }\n            </ul>\n            <FormSend id={id} userId={userId} />\n        </>\n    )\n}\n\nexport default RenderChat\n"]},"metadata":{},"sourceType":"module"}