{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/duythai/Developer/sadness/a-client/src/component/chatComponent/chat.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState, useRef } from 'react';\nimport classNames from 'classnames';\nimport { getCookie, decryptWithAES } from '../../helpers/auth';\nimport axios from \"axios\";\nimport socketApp from '../../socket';\nimport { messageLiRender, messageLiImageRender, executeScroll, Spinning, FormSend } from '../../helpers/message';\n\nfunction Chat() {\n  _s();\n\n  let socket = socketApp.getSocket();\n  const id = getCookie().token;\n  const ipOfUser = \"Dong nai\";\n  const [value, setValue] = useState([]); // len is len of rooms the user had join\n\n  const [len, SetLen] = useState(0); //This id room contain every id of the message that they have\n  // waitG = wait group\n\n  const [waitG, setWaitG] = useState(null);\n  const [idRoom, setidRoom] = useState(null);\n  const [wait, setWait] = useState(false);\n  const [finish, setFinish] = useState(false);\n  const myRef = useRef(null);\n\n  const HanldeClickFind = e => {\n    if (wait !== true) {\n      socket.emit(\"joinChat\", {\n        id,\n        len,\n        ipOfUser\n      }, error => {\n        if (error === \"error\") {\n          setWait(true);\n        } else {\n          setFinish(true);\n          setidRoom(error);\n        }\n      });\n    } else {\n      setWait(false);\n      socket.emit(\"joinChat\", {\n        id,\n        len,\n        ipOfUser\n      }, error => {\n        if (error !== \"error\") {\n          setFinish(true);\n          setidRoom(error);\n        }\n      });\n    }\n  }; //Fetch data to recive the idRoom\n\n\n  useEffect(() => {\n    const source = axios.CancelToken.source();\n\n    const fetchData = async () => {\n      try {\n        await axios.post(\"http://localhost:2704/api/msgC/getIdRoom\", {\n          id\n        }).then(res => {\n          SetLen(res.data.len);\n        });\n      } catch (error) {}\n    };\n\n    fetchData();\n    return () => {\n      source.cancel();\n    };\n  }, [id]); //load message\n\n  useEffect(() => {\n    let fnc = () => {\n      socket.on(\"message\", msg => {\n        if (msg.roomId) {\n          // If we have a couple together than we start to chat\n          setWait(false);\n          setFinish(true);\n          setidRoom(msg.roomId);\n        }\n\n        if (msg.image) {\n          // if message send is image\n          setValue(img => [...img, msg.image]);\n        } else if (msg.data) {\n          setValue(msgs => [...msgs, msg.data]);\n          executeScroll(myRef);\n        }\n      });\n    };\n\n    idRoom ? fnc() : console.log();\n  }, [socket]); //defined button find partner classname\n\n  var btnClassFind = classNames({\n    \"onclic\": wait\n  });\n\n  const changeStateWaitGroup = () => {\n    if (waitG === null) {\n      setWaitG(\"active\");\n      socket.emit(\"joinChatGroup\", {\n        id,\n        len,\n        ipOfUser\n      }, callback => {\n        if (callback !== \"error\") {\n          setFinish(true);\n          setidRoom(callback);\n        }\n      });\n    } else {\n      setWaitG(null);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"message_container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container_button\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"part_1\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          style: finish === true ? {\n            display: \"none\"\n          } : {},\n          id: \"button_find_partner\",\n          className: btnClassFind,\n          onClick: HanldeClickFind,\n          children: wait === true ? /*#__PURE__*/_jsxDEV(Spinning, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 114,\n            columnNumber: 42\n          }, this) : \"Tìm cặp\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: finish === true ? {\n          display: \"none\"\n        } : {},\n        className: \"part_2\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: changeStateWaitGroup,\n          className: \"chat_button_group \" + waitG,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat_button_group\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"background\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 122,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"chat-bubble\",\n              width: \"100\",\n              height: \"100\",\n              viewBox: \"0 0 100 100\",\n              children: [/*#__PURE__*/_jsxDEV(\"g\", {\n                className: \"bubble\",\n                children: [/*#__PURE__*/_jsxDEV(\"path\", {\n                  className: \"line line1\",\n                  d: \"M 30.7873,85.113394 30.7873,46.556405 C 30.7873,41.101961 36.826342,35.342 40.898074,35.342 H 59.113981 C 63.73287,35.342 69.29995,40.103201 69.29995,46.784744\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 125,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                  className: \"line line2\",\n                  d: \"M 13.461999,65.039335 H 58.028684 C 63.483128,65.039335 69.243089,59.000293 69.243089,54.928561 V 45.605853 C 69.243089,40.986964 65.02087,35.419884 58.339327,35.419884\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 128,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 124,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n                className: \"circle circle1\",\n                r: \"1.9\",\n                cy: \"50.7\",\n                cx: \"42.5\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 133,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n                className: \"circle circle2\",\n                cx: \"49.9\",\n                cy: \"50.7\",\n                r: \"1.9\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 134,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n                className: \"circle circle3\",\n                r: \"1.9\",\n                cy: \"50.7\",\n                cx: \"57.3\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 135,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 123,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n      style: finish === false ? {\n        display: \"none\"\n      } : {},\n      children: value.length > 0 ? value.map(function (item, i) {\n        if (item.image) {\n          let imgUrl = item.image;\n          if (item.id === idRoom) return messageLiImageRender(\"mIOwn\", i, imgUrl, myRef);else return messageLiImageRender(\"mIOther\", i, imgUrl, myRef);\n        } else {\n          let msgs = item.data[0] ? decryptWithAES(item.data[0]) : \"\";\n          if (item.id === id) return messageLiRender(\"messageLiOwn\", \"own_message_same_div messageLiOwnm60\", \"own_message_same_div messageLiOwnl60\", msgs, i, myRef);else return messageLiRender(\"messageLiOther\", \"other_message_same_div messageLiOtherm60\", \"other_message_same_div messageLiOtherl60\", msgs, i, myRef);\n        }\n      }) : console.log()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 13\n    }, this), idRoom ? /*#__PURE__*/_jsxDEV(FormSend, {\n      id: idRoom,\n      userId: id\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 24\n    }, this) : console.log()]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 105,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Chat, \"QVDQ2asEisVvxRVdP2h4wJqx+cA=\");\n\n_c = Chat;\nexport default Chat;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"sources":["/home/duythai/Developer/sadness/a-client/src/component/chatComponent/chat.js"],"names":["React","useEffect","useState","useRef","classNames","getCookie","decryptWithAES","axios","socketApp","messageLiRender","messageLiImageRender","executeScroll","Spinning","FormSend","Chat","socket","getSocket","id","token","ipOfUser","value","setValue","len","SetLen","waitG","setWaitG","idRoom","setidRoom","wait","setWait","finish","setFinish","myRef","HanldeClickFind","e","emit","error","source","CancelToken","fetchData","post","then","res","data","cancel","fnc","on","msg","roomId","image","img","msgs","console","log","btnClassFind","changeStateWaitGroup","callback","display","length","map","item","i","imgUrl"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\nimport classNames from 'classnames';\nimport { getCookie, decryptWithAES } from '../../helpers/auth';\nimport axios from \"axios\"\nimport socketApp from '../../socket';\nimport { messageLiRender, messageLiImageRender, executeScroll, Spinning, FormSend } from '../../helpers/message';\n\nfunction Chat() {\n    let socket = socketApp.getSocket();\n    const id = getCookie().token;\n    const ipOfUser = \"Dong nai\";\n    const [value, setValue] = useState([]);\n    // len is len of rooms the user had join\n    const [len, SetLen] = useState(0);\n\n    //This id room contain every id of the message that they have\n    // waitG = wait group\n    const [waitG, setWaitG] = useState(null);\n\n    const [idRoom, setidRoom] = useState(null);\n    const [wait, setWait] = useState(false);\n    const [finish, setFinish] = useState(false);\n    const myRef = useRef(null)\n\n\n\n    const HanldeClickFind = (e) => {\n        if (wait !== true) {\n            socket.emit(\"joinChat\", { id, len, ipOfUser }, (error) => {\n                if (error === \"error\") {\n                    setWait(true)\n                } else {\n                    setFinish(true)\n                    setidRoom(error)\n                }\n            })\n        } else {\n            setWait(false)\n            socket.emit(\"joinChat\", { id, len, ipOfUser }, (error) => {\n                if (error !== \"error\") {\n                    setFinish(true)\n                    setidRoom(error)\n                }\n            })\n        }\n    }\n    //Fetch data to recive the idRoom\n    useEffect(() => {\n        const source = axios.CancelToken.source()\n        const fetchData = async () => {\n            try {\n                await axios.post(\"http://localhost:2704/api/msgC/getIdRoom\", { id })\n                    .then(res => {\n                        SetLen(res.data.len)\n                    })\n            } catch (error) {\n            }\n        }\n        fetchData()\n        return () => {\n            source.cancel()\n        }\n    }, [id])\n    //load message\n    useEffect(() => {\n        let fnc = () => {\n            socket.on(\"message\", msg => {\n                if (msg.roomId) {\n                    // If we have a couple together than we start to chat\n                    setWait(false)\n                    setFinish(true)\n                    setidRoom(msg.roomId)\n                }\n                if (msg.image) {\n                    // if message send is image\n                    setValue(img => [...img, msg.image])\n                }\n                else if (msg.data) {\n                    setValue(msgs => [...msgs, msg.data])\n                    executeScroll(myRef)\n                }\n            })\n        }\n        idRoom ? fnc() : console.log()\n    }, [socket])\n    //defined button find partner classname\n    var btnClassFind = classNames({\n        \"onclic\": wait,\n    })\n    const changeStateWaitGroup = () => {\n        if (waitG === null) {\n            setWaitG(\"active\")\n            socket.emit(\"joinChatGroup\", { id, len, ipOfUser }, (callback) => {\n                if (callback !== \"error\") {\n                    setFinish(true)\n                    setidRoom(callback)\n                }\n            })\n        }\n        else {\n            setWaitG(null)\n        }\n    }\n    return (\n        <div className=\"message_container\">\n            <div className=\"container_button\">\n                <div className=\"part_1\">\n                    <button\n                        style={finish === true ? { display: \"none\" } : {}}\n                        id=\"button_find_partner\"\n                        className={btnClassFind}\n                        onClick={HanldeClickFind}\n                    >\n                        {wait === true ? < Spinning /> : \"Tìm cặp\"}\n                    </button>\n                </div>\n                <div\n                    style={finish === true ? { display: \"none\" } : {}}\n                    className=\"part_2\">\n                    <div onClick={changeStateWaitGroup} className={\"chat_button_group \" + waitG}>\n                        <div className=\"chat_button_group\" >\n                            <div className=\"background\"></div>\n                            <svg className=\"chat-bubble\" width=\"100\" height=\"100\" viewBox=\"0 0 100 100\">\n                                <g className=\"bubble\">\n                                    <path className=\"line line1\" d=\"M 30.7873,85.113394 30.7873,46.556405 C 30.7873,41.101961\n          36.826342,35.342 40.898074,35.342 H 59.113981 C 63.73287,35.342\n          69.29995,40.103201 69.29995,46.784744\" />\n                                    <path className=\"line line2\" d=\"M 13.461999,65.039335 H 58.028684 C\n            63.483128,65.039335\n            69.243089,59.000293 69.243089,54.928561 V 45.605853 C\n            69.243089,40.986964 65.02087,35.419884 58.339327,35.419884\" />\n                                </g>\n                                <circle className=\"circle circle1\" r=\"1.9\" cy=\"50.7\" cx=\"42.5\" />\n                                <circle className=\"circle circle2\" cx=\"49.9\" cy=\"50.7\" r=\"1.9\" />\n                                <circle className=\"circle circle3\" r=\"1.9\" cy=\"50.7\" cx=\"57.3\" />\n                            </svg>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <ul\n                style={finish === false ? { display: \"none\" } : {}}>\n                {\n                    value.length > 0 ?\n                        value.map(function (item, i) {\n                            if (item.image) {\n                                let imgUrl = item.image\n                                if (item.id === idRoom) return messageLiImageRender(\"mIOwn\", i, imgUrl, myRef)\n                                else return messageLiImageRender(\"mIOther\", i, imgUrl, myRef)\n                            } else {\n                                let msgs = item.data[0] ? decryptWithAES(item.data[0]) : \"\"\n                                if (item.id === id) return messageLiRender(\"messageLiOwn\", \"own_message_same_div messageLiOwnm60\", \"own_message_same_div messageLiOwnl60\", msgs, i, myRef)\n                                else return messageLiRender(\"messageLiOther\", \"other_message_same_div messageLiOtherm60\", \"other_message_same_div messageLiOtherl60\", msgs, i, myRef)\n                            }\n                        }) : console.log()\n                }\n            </ul>\n            { idRoom ? <FormSend id={idRoom} userId={id} /> : console.log()}\n        </div>\n    )\n}\n\nexport default Chat\n"]},"metadata":{},"sourceType":"module"}