{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/duythai/Developer/sadness/a-client/src/component/chatComponent/chat.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState, useRef } from 'react';\nimport classNames from 'classnames';\nimport { getCookie, decryptWithAES } from '../../helpers/auth';\nimport axios from \"axios\";\nimport socketApp from '../../socket';\nimport { messageLiRender, messageLiImageRender, executeScroll, Spinning, FormSend } from '../../helpers/message';\n\nfunction Chat() {\n  _s();\n\n  let socket = socketApp.getSocket();\n  const id = getCookie().token;\n  const ipOfUser = \"Dong nai\";\n  const [value, setValue] = useState([]); // len is len of rooms the user had join\n\n  const [len, SetLen] = useState(0); //This id room contain every id of the message that they have\n  // waitG = wait group\n\n  const [waitG, setWaitG] = useState(null);\n  const [idRoom, setidRoom] = useState(null);\n  const [wait, setWait] = useState(false);\n  const [finish, setFinish] = useState(false);\n  const myRef = useRef(null);\n\n  const HanldeClickFind = e => {\n    if (wait !== true) {\n      socket.emit(\"joinChat\", {\n        id,\n        len,\n        ipOfUser\n      }, error => {\n        if (error === \"error\") {\n          setWait(true);\n        } else {\n          console.log(error);\n          setFinish(true);\n          setidRoom(error);\n        }\n      });\n    } else {\n      setWait(false);\n      socket.emit(\"joinChat\", {\n        id,\n        len,\n        ipOfUser\n      }, error => {\n        if (error !== \"error\") {\n          console.log(error);\n          setFinish(true);\n          setidRoom(error);\n        }\n      });\n    }\n  }; //Fetch data to recive the idRoom\n\n\n  useEffect(() => {\n    const source = axios.CancelToken.source();\n\n    const fetchData = async () => {\n      try {\n        await axios.post(\"http://localhost:2704/api/msgC/getIdRoom\", {\n          id\n        }).then(res => {\n          SetLen(res.data.len);\n        });\n      } catch (error) {}\n    };\n\n    fetchData();\n    return () => {\n      source.cancel();\n    };\n  }, [id]); //load message\n\n  useEffect(() => {\n    socket.on(\"message\", msg => {\n      if (msg.roomId) {\n        // If we have a couple together than we start to chat\n        console.log(msg);\n        setWait(false);\n        setFinish(true);\n        setidRoom(msg.roomId);\n      }\n\n      if (msg.image && idRoom === msg.idRoom) {\n        // if message send is image\n        setValue(img => [...img, msg.image]);\n      } else if (msg.data && idRoom === msg.idRoom) {\n        setValue(msgs => [...msgs, msg.data]);\n        executeScroll(myRef);\n      }\n    });\n  }, [socket, idRoom]); //defined button find partner classname\n\n  var btnClassFind = classNames({\n    \"onclic\": wait\n  });\n  console.log(idRoom);\n\n  const changeStateWaitGroup = () => {\n    if (waitG === null) {\n      setWaitG(\"active\");\n      socket.emit(\"joinChatGroup\", {\n        id,\n        len,\n        ipOfUser\n      }, callback => {\n        if (callback !== \"error\") {\n          setFinish(true);\n          setidRoom(callback);\n        }\n      });\n    } else {\n      setWaitG(null);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"message_container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container_button\",\n      style: finish === true ? {\n        display: \"none\"\n      } : {},\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"part_1\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          id: \"button_find_partner\",\n          className: `${btnClassFind} tooltip`,\n          onClick: HanldeClickFind,\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"tooltiptext\",\n            children: \"T\\xECm c\\u1EB7p\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 112,\n            columnNumber: 25\n          }, this), wait === true ? /*#__PURE__*/_jsxDEV(Spinning, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 42\n          }, this) : \"Tìm cặp\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"part_2 \",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat_button_group tooltip \" + waitG,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            onClick: changeStateWaitGroup,\n            className: \"background\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"chat-bubble\",\n            width: \"100\",\n            height: \"100\",\n            viewBox: \"0 0 100 100\",\n            children: [/*#__PURE__*/_jsxDEV(\"g\", {\n              className: \"bubble\",\n              children: [/*#__PURE__*/_jsxDEV(\"path\", {\n                className: \"line line1\",\n                d: \"M 30.7873,85.113394 30.7873,46.556405 C 30.7873,41.101961          36.826342,35.342 40.898074,35.342 H 59.113981 C 63.73287,35.342          69.29995,40.103201 69.29995,46.784744\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 124,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                className: \"line line2\",\n                d: \"M 13.461999,65.039335 H 58.028684 C            63.483128,65.039335 69.243089,59.000293 69.243089,54.928561 V 45.605853 C            69.243089,40.986964 65.02087,35.419884 58.339327,35.419884\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 125,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 123,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n              className: \"circle circle1\",\n              r: \"1.9\",\n              cy: \"50.7\",\n              cx: \"42.5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 127,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n              className: \"circle circle2\",\n              cx: \"49.9\",\n              cy: \"50.7\",\n              r: \"1.9\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 128,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n              className: \"circle circle3\",\n              r: \"1.9\",\n              cy: \"50.7\",\n              cx: \"57.3\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 129,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 122,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"tooltiptext\",\n            children: \"Gh\\xE9p nh\\xF3m\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"message_container_div\",\n      style: finish === false ? {\n        display: \"none\"\n      } : {\n        display: \"block\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"ul\", {\n        children: value.length > 0 ? value.map(function (item, i) {\n          if (item.image) {\n            let imgUrl = item.image;\n            if (item.id === idRoom) return messageLiImageRender(\"mIOwn\", i, imgUrl, myRef);else return messageLiImageRender(\"mIOther\", i, imgUrl, myRef);\n          } else {\n            let msgs = item.data[0] ? decryptWithAES(item.data[0]) : \"\";\n            if (item.id === id) return messageLiRender(\"messageLiOwn\", \"own_message_same_div messageLiOwnm60\", \"own_message_same_div messageLiOwnl60\", msgs, i, myRef);else return messageLiRender(\"messageLiOther\", \"other_message_same_div messageLiOtherm60\", \"other_message_same_div messageLiOtherl60\", msgs, i, myRef);\n          }\n        }) : console.log()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 17\n      }, this), idRoom ? /*#__PURE__*/_jsxDEV(FormSend, {\n        id: idRoom,\n        userId: id\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 27\n      }, this) : console.log()]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 104,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Chat, \"QVDQ2asEisVvxRVdP2h4wJqx+cA=\");\n\n_c = Chat;\nexport default Chat;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"sources":["/home/duythai/Developer/sadness/a-client/src/component/chatComponent/chat.js"],"names":["React","useEffect","useState","useRef","classNames","getCookie","decryptWithAES","axios","socketApp","messageLiRender","messageLiImageRender","executeScroll","Spinning","FormSend","Chat","socket","getSocket","id","token","ipOfUser","value","setValue","len","SetLen","waitG","setWaitG","idRoom","setidRoom","wait","setWait","finish","setFinish","myRef","HanldeClickFind","e","emit","error","console","log","source","CancelToken","fetchData","post","then","res","data","cancel","on","msg","roomId","image","img","msgs","btnClassFind","changeStateWaitGroup","callback","display","length","map","item","i","imgUrl"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\nimport classNames from 'classnames';\nimport { getCookie, decryptWithAES } from '../../helpers/auth';\nimport axios from \"axios\"\nimport socketApp from '../../socket';\nimport { messageLiRender, messageLiImageRender, executeScroll, Spinning, FormSend } from '../../helpers/message';\n\nfunction Chat() {\n    let socket = socketApp.getSocket();\n    const id = getCookie().token;\n    const ipOfUser = \"Dong nai\";\n    const [value, setValue] = useState([]);\n    // len is len of rooms the user had join\n    const [len, SetLen] = useState(0);\n\n    //This id room contain every id of the message that they have\n    // waitG = wait group\n    const [waitG, setWaitG] = useState(null);\n\n    const [idRoom, setidRoom] = useState(null);\n    const [wait, setWait] = useState(false);\n    const [finish, setFinish] = useState(false);\n    const myRef = useRef(null)\n\n    const HanldeClickFind = (e) => {\n        if (wait !== true) {\n            socket.emit(\"joinChat\", { id, len, ipOfUser }, (error) => {\n                if (error === \"error\") {\n                    setWait(true)\n                } else {\n                    console.log(error)\n                    setFinish(true)\n                    setidRoom(error)\n                }\n            })\n        } else {\n            setWait(false)\n            socket.emit(\"joinChat\", { id, len, ipOfUser }, (error) => {\n                if (error !== \"error\") {\n                    console.log(error)\n                    setFinish(true)\n                    setidRoom(error)\n                }\n            })\n        }\n    }\n    //Fetch data to recive the idRoom\n    useEffect(() => {\n        const source = axios.CancelToken.source()\n        const fetchData = async () => {\n            try {\n                await axios.post(\"http://localhost:2704/api/msgC/getIdRoom\", { id })\n                    .then(res => {\n                        SetLen(res.data.len)\n                    })\n            } catch (error) {\n            }\n        }\n        fetchData()\n        return () => {\n            source.cancel()\n        }\n    }, [id])\n    //load message\n    useEffect(() => {\n        socket.on(\"message\", msg => {\n            if (msg.roomId) {\n                // If we have a couple together than we start to chat\n                console.log(msg)\n                setWait(false)\n                setFinish(true)\n                setidRoom(msg.roomId)\n            }\n            if (msg.image && idRoom === msg.idRoom) {\n                // if message send is image\n                setValue(img => [...img, msg.image])\n            }\n            else if (msg.data && idRoom === msg.idRoom) {\n                setValue(msgs => [...msgs, msg.data])\n                executeScroll(myRef)\n            }\n        })\n    }, [socket, idRoom])\n    //defined button find partner classname\n    var btnClassFind = classNames({\n        \"onclic\": wait,\n    })\n    console.log(idRoom)\n    const changeStateWaitGroup = () => {\n        if (waitG === null) {\n            setWaitG(\"active\")\n            socket.emit(\"joinChatGroup\", { id, len, ipOfUser }, (callback) => {\n                if (callback !== \"error\") {\n                    setFinish(true)\n                    setidRoom(callback)\n                }\n            })\n        }\n        else {\n            setWaitG(null)\n        }\n    }\n    return (\n        <div className=\"message_container\">\n            <div className=\"container_button\" style={finish === true ? { display: \"none\" } : {}}>\n                <div className=\"part_1\">\n                    <button\n                        id=\"button_find_partner\"\n                        className={`${btnClassFind} tooltip`}\n                        onClick={HanldeClickFind}\n                    >\n                        <span className=\"tooltiptext\">\n                            Tìm cặp\n                        </span>\n                        {wait === true ? < Spinning /> : \"Tìm cặp\"}\n                    </button>\n\n                </div>\n                <div className=\"part_2 \">\n                    <div className={\"chat_button_group tooltip \" + waitG}>\n                        <div onClick={changeStateWaitGroup} className=\"background\"></div>\n                        <svg className=\"chat-bubble\" width=\"100\" height=\"100\" viewBox=\"0 0 100 100\">\n                            <g className=\"bubble\">\n                                <path className=\"line line1\" d=\"M 30.7873,85.113394 30.7873,46.556405 C 30.7873,41.101961          36.826342,35.342 40.898074,35.342 H 59.113981 C 63.73287,35.342          69.29995,40.103201 69.29995,46.784744\" />\n                                <path className=\"line line2\" d=\"M 13.461999,65.039335 H 58.028684 C            63.483128,65.039335 69.243089,59.000293 69.243089,54.928561 V 45.605853 C            69.243089,40.986964 65.02087,35.419884 58.339327,35.419884\" />\n                            </g>\n                            <circle className=\"circle circle1\" r=\"1.9\" cy=\"50.7\" cx=\"42.5\" />\n                            <circle className=\"circle circle2\" cx=\"49.9\" cy=\"50.7\" r=\"1.9\" />\n                            <circle className=\"circle circle3\" r=\"1.9\" cy=\"50.7\" cx=\"57.3\" />\n                        </svg>\n                        <span className=\"tooltiptext\">\n                            Ghép nhóm\n                        </span>\n                    </div>\n                </div>\n\n            </div>\n            <div className=\"message_container_div\" style={finish === false ? { display: \"none\" } : { display: \"block\" }}>\n                <ul>\n                    {\n                        value.length > 0 ?\n                            value.map(function (item, i) {\n                                if (item.image) {\n                                    let imgUrl = item.image\n                                    if (item.id === idRoom) return messageLiImageRender(\"mIOwn\", i, imgUrl, myRef)\n                                    else return messageLiImageRender(\"mIOther\", i, imgUrl, myRef)\n                                } else {\n                                    let msgs = item.data[0] ? decryptWithAES(item.data[0]) : \"\"\n                                    if (item.id === id) return messageLiRender(\"messageLiOwn\", \"own_message_same_div messageLiOwnm60\", \"own_message_same_div messageLiOwnl60\", msgs, i, myRef)\n                                    else return messageLiRender(\"messageLiOther\", \"other_message_same_div messageLiOtherm60\", \"other_message_same_div messageLiOtherl60\", msgs, i, myRef)\n                                }\n                            }) : console.log()\n                    }\n                </ul>\n                {idRoom ? <FormSend id={idRoom} userId={id} /> : console.log()}\n            </div>\n        </div >\n    )\n}\n\nexport default Chat\n"]},"metadata":{},"sourceType":"module"}