{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import _objectSpread from\"/home/duythai/Developer/sadness/a-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{jsx as _jsx}from\"react/jsx-runtime\";import _createForOfIteratorHelper from\"/home/duythai/Developer/sadness/a-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _toConsumableArray from\"/home/duythai/Developer/sadness/a-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/duythai/Developer/sadness/a-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useMemo,useState,useEffect}from'react';import'./App.css';import{useHistory}from'react-router-dom';import{BrowserRouter,Switch,Route}from\"react-router-dom\";import ActivatePage from'./component/loginComponent/activate';import Forget from'./component/loginComponent/forget';import ChangePassword from'./component/loginComponent/changePassword';import HomePage from'./component/HomePage';import Chat from'./component/chatComponent/chat';import NewsMain from'./component/newsComponents/newsMain';import Main_block from'./component/main.block';import ViewOneBlog from'./component/newsComponents/viewBlog/viewOneBlog';import{Notifications,MessageList}from'./userContext';import axios from\"axios\";import{getCookie}from'./helpers/auth';import socketApp from'./socket';import{toast}from\"react-toastify\";import Policy from'./component/anotherPage/policy';import SuggestPage from'./component/anotherPage/suggestPage';function App(){var socket=socketApp.getSocket();var id=getCookie().token;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),value=_useState2[0],setValue=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),listMessage=_useState4[0],setListMessage=_useState4[1];var notifications=useMemo(function(){return{value:value,setValue:setValue};},[value,setValue]);var messageList=useMemo(function(){return{listMessage:listMessage,setListMessage:setListMessage};},[listMessage,setListMessage]);var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),start=_useState6[0],setStart=_useState6[1];var _useState7=useState(10),_useState8=_slicedToArray(_useState7,2),end=_useState8[0],setEnd=_useState8[1];var history=useHistory();var forLoop=function forLoop(arr,msgs){for(var i=0;i<arr.length;i++){if(arr[i].idRoom===msgs.idRoom&&i!==0){arr.splice(i,1);arr.unshift(msgs);return setListMessage(arr);}else if(arr[i].idRoom===msgs.idRoom&&i===0){arr[0]=msgs;return setListMessage(arr);}}};var fnc=function fnc(){var arr=_toConsumableArray(listMessage);socket.once(\"message\",function(msgs){return msgs.type===\"message\"&&forLoop(arr,msgs);});};useEffect(function(){id&&socket.emit(\"join\",{id:id});socket.on(\"activities\",function(msg){return toast.info(msg.number+msg.value);});},[socket,id]);useEffect(function(){axios.get(\"http://localhost:2704/api/news/notifications?id=\"+id+\"&start=0&end=10\").then(function(res){var fnc=function fnc(){var _iterator=_createForOfIteratorHelper(res.data.value),_step;try{var _loop=function _loop(){var data=_step.value;var arr={type:data.value,value:data.type,number:data.number};setValue(function(a){return[].concat(_toConsumableArray(a),[arr]);});};for(_iterator.s();!(_step=_iterator.n()).done;){_loop();}}catch(err){_iterator.e(err);}finally{_iterator.f();}};res.data.value!==undefined&&fnc();}).catch(function(err){});axios.post(\"http://localhost:2704/api/msgC/contactL?start=\"+start+\"&end=\"+end,{id:id}).then(function(res){if(res.data.message)history.push(\"/report\");else setListMessage(res.data);}).catch(function(err){});},[id]);useEffect(function(){listMessage&&fnc();},[listMessage]);return/*#__PURE__*/_jsx(BrowserRouter,{children:/*#__PURE__*/_jsx(Switch,{children:/*#__PURE__*/_jsx(MessageList.Provider,{value:messageList,children:/*#__PURE__*/_jsxs(Notifications.Provider,{value:notifications,children:[listMessage?/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",children:/*#__PURE__*/_jsx(HomePage,{})}):console.log(),/*#__PURE__*/_jsx(Route,{path:\"/users/active/:token\",exact:true,render:function render(props){return/*#__PURE__*/_jsx(ActivatePage,_objectSpread({},props));}}),/*#__PURE__*/_jsx(Route,{path:\"/users/forget\",exact:true,render:function render(props){return/*#__PURE__*/_jsx(Forget,_objectSpread({},props));}}),/*#__PURE__*/_jsx(Route,{path:\"/users/password/forget/:token\",exact:true,render:function render(props){return/*#__PURE__*/_jsx(ChangePassword,_objectSpread({},props));}}),/*#__PURE__*/_jsx(Route,{path:\"/chat\",component:Chat}),/*#__PURE__*/_jsx(Route,{path:\"/news\",component:NewsMain}),/*#__PURE__*/_jsx(Route,{path:\"/report\",component:Main_block}),/*#__PURE__*/_jsx(Route,{path:\"/posts/id=:id\",render:function render(props){return/*#__PURE__*/_jsx(ViewOneBlog,_objectSpread({},props));}}),/*#__PURE__*/_jsx(Route,{path:\"/policy\",render:function render(props){return/*#__PURE__*/_jsx(Policy,_objectSpread({},props));}}),/*#__PURE__*/_jsx(Route,{path:\"/suggest\",render:function render(props){return/*#__PURE__*/_jsx(SuggestPage,_objectSpread({},props));}})]})})})});}export default App;","map":{"version":3,"sources":["/home/duythai/Developer/sadness/a-client/src/App.js"],"names":["React","useMemo","useState","useEffect","useHistory","BrowserRouter","Switch","Route","ActivatePage","Forget","ChangePassword","HomePage","Chat","NewsMain","Main_block","ViewOneBlog","Notifications","MessageList","axios","getCookie","socketApp","toast","Policy","SuggestPage","App","socket","getSocket","id","token","value","setValue","listMessage","setListMessage","notifications","messageList","start","setStart","end","setEnd","history","forLoop","arr","msgs","i","length","idRoom","splice","unshift","fnc","once","type","emit","on","msg","info","number","get","then","res","data","a","undefined","catch","err","post","message","push","console","log","props"],"mappings":"mvBAAA,MAAOA,CAAAA,KAAP,EAAgBC,OAAhB,CAAyBC,QAAzB,CAAmCC,SAAnC,KAAoD,OAApD,CACA,MAAO,WAAP,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,OAASC,aAAT,CAAwBC,MAAxB,CAAgCC,KAAhC,KAA6C,kBAA7C,CACA,MAAOC,CAAAA,YAAP,KAAyB,qCAAzB,CACA,MAAOC,CAAAA,MAAP,KAAmB,mCAAnB,CACA,MAAOC,CAAAA,cAAP,KAA2B,2CAA3B,CACA,MAAOC,CAAAA,QAAP,KAAqB,sBAArB,CACA,MAAOC,CAAAA,IAAP,KAAiB,gCAAjB,CACA,MAAOC,CAAAA,QAAP,KAAqB,qCAArB,CACA,MAAOC,CAAAA,UAAP,KAAuB,wBAAvB,CACA,MAAOC,CAAAA,WAAP,KAAwB,iDAAxB,CACA,OAASC,aAAT,CAAwBC,WAAxB,KAA2C,eAA3C,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,SAAT,KAA0B,gBAA1B,CACA,MAAOC,CAAAA,SAAP,KAAsB,UAAtB,CACA,OAASC,KAAT,KAAsB,gBAAtB,CACA,MAAOC,CAAAA,MAAP,KAAmB,gCAAnB,CACA,MAAOC,CAAAA,WAAP,KAAwB,qCAAxB,CAGA,QAASC,CAAAA,GAAT,EAAe,CACb,GAAIC,CAAAA,MAAM,CAAGL,SAAS,CAACM,SAAV,EAAb,CACA,GAAMC,CAAAA,EAAE,CAAGR,SAAS,GAAGS,KAAvB,CAFa,cAGa1B,QAAQ,CAAC,EAAD,CAHrB,wCAGN2B,KAHM,eAGCC,QAHD,8BAIyB5B,QAAQ,CAAC,IAAD,CAJjC,yCAIN6B,WAJM,eAIOC,cAJP,eAKb,GAAMC,CAAAA,aAAa,CAAGhC,OAAO,CAAC,iBAAO,CAAE4B,KAAK,CAALA,KAAF,CAASC,QAAQ,CAARA,QAAT,CAAP,EAAD,CAA8B,CAACD,KAAD,CAAQC,QAAR,CAA9B,CAA7B,CACA,GAAMI,CAAAA,WAAW,CAAGjC,OAAO,CAAC,iBAAO,CAAE8B,WAAW,CAAXA,WAAF,CAAeC,cAAc,CAAdA,cAAf,CAAP,EAAD,CAA0C,CAACD,WAAD,CAAcC,cAAd,CAA1C,CAA3B,CANa,eAOa9B,QAAQ,CAAC,CAAD,CAPrB,yCAONiC,KAPM,eAOCC,QAPD,8BAQSlC,QAAQ,CAAC,EAAD,CARjB,yCAQNmC,GARM,eAQDC,MARC,eASb,GAAMC,CAAAA,OAAO,CAAGnC,UAAU,EAA1B,CAGA,GAAIoC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,CAACC,GAAD,CAAMC,IAAN,CAAe,CAC3B,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGF,GAAG,CAACG,MAAxB,CAAgCD,CAAC,EAAjC,CAAqC,CACnC,GAAIF,GAAG,CAACE,CAAD,CAAH,CAAOE,MAAP,GAAkBH,IAAI,CAACG,MAAvB,EAAiCF,CAAC,GAAK,CAA3C,CAA8C,CAC5CF,GAAG,CAACK,MAAJ,CAAWH,CAAX,CAAc,CAAd,EACAF,GAAG,CAACM,OAAJ,CAAYL,IAAZ,EACA,MAAOV,CAAAA,cAAc,CAACS,GAAD,CAArB,CACD,CAJD,IAKK,IAAIA,GAAG,CAACE,CAAD,CAAH,CAAOE,MAAP,GAAkBH,IAAI,CAACG,MAAvB,EAAiCF,CAAC,GAAK,CAA3C,CAA8C,CACjDF,GAAG,CAAC,CAAD,CAAH,CAASC,IAAT,CACA,MAAOV,CAAAA,cAAc,CAACS,GAAD,CAArB,CACD,CACF,CACF,CAZD,CAaA,GAAIO,CAAAA,GAAG,CAAG,QAANA,CAAAA,GAAM,EAAM,CACd,GAAIP,CAAAA,GAAG,oBAAOV,WAAP,CAAP,CACAN,MAAM,CAACwB,IAAP,CAAY,SAAZ,CAAuB,SAAAP,IAAI,QAAIA,CAAAA,IAAI,CAACQ,IAAL,GAAc,SAAd,EAA2BV,OAAO,CAACC,GAAD,CAAMC,IAAN,CAAtC,EAA3B,EACD,CAHD,CAKAvC,SAAS,CAAC,UAAM,CACdwB,EAAE,EAAIF,MAAM,CAAC0B,IAAP,CAAY,MAAZ,CAAoB,CAAExB,EAAE,CAAFA,EAAF,CAApB,CAAN,CACAF,MAAM,CAAC2B,EAAP,CAAU,YAAV,CAAwB,SAAAC,GAAG,QAAIhC,CAAAA,KAAK,CAACiC,IAAN,CAAWD,GAAG,CAACE,MAAJ,CAAaF,GAAG,CAACxB,KAA5B,CAAJ,EAA3B,EACD,CAHQ,CAGN,CAACJ,MAAD,CAASE,EAAT,CAHM,CAAT,CAKAxB,SAAS,CAAC,UAAM,CACde,KAAK,CAACsC,GAAN,CAAU,mDAAqD7B,EAArD,CAA0D,iBAApE,EACG8B,IADH,CACQ,SAAAC,GAAG,CAAI,CACX,GAAIV,CAAAA,GAAG,CAAG,QAANA,CAAAA,GAAM,EAAM,0CACGU,GAAG,CAACC,IAAJ,CAAS9B,KADZ,0CACL8B,CAAAA,IADK,aAEZ,GAAIlB,CAAAA,GAAG,CAAG,CACRS,IAAI,CAAES,IAAI,CAAC9B,KADH,CAERA,KAAK,CAAE8B,IAAI,CAACT,IAFJ,CAGRK,MAAM,CAAEI,IAAI,CAACJ,MAHL,CAAV,CAKAzB,QAAQ,CAAC,SAAA8B,CAAC,qCAAQA,CAAR,GAAWnB,GAAX,IAAF,CAAR,CAPY,EACd,+CAAiC,SAOhC,CARa,qDASf,CATD,CAUAiB,GAAG,CAACC,IAAJ,CAAS9B,KAAT,GAAmBgC,SAAnB,EAAgCb,GAAG,EAAnC,CACD,CAbH,EAaKc,KAbL,CAaW,SAAAC,GAAG,CAAI,CAAG,CAbrB,EAeA7C,KAAK,CAAC8C,IAAN,CAAW,iDAAmD7B,KAAnD,CAA2D,OAA3D,CAAqEE,GAAhF,CAAqF,CAAEV,EAAE,CAAFA,EAAF,CAArF,EACG8B,IADH,CACQ,SAAAC,GAAG,CAAI,CACX,GAAIA,GAAG,CAACC,IAAJ,CAASM,OAAb,CAAsB1B,OAAO,CAAC2B,IAAR,CAAa,SAAb,EAAtB,IACKlC,CAAAA,cAAc,CAAC0B,GAAG,CAACC,IAAL,CAAd,CACN,CAJH,EAIKG,KAJL,CAIW,SAAAC,GAAG,CAAI,CAAG,CAJrB,EAKD,CArBQ,CAqBN,CAACpC,EAAD,CArBM,CAAT,CAuBAxB,SAAS,CAAC,UAAM,CACd4B,WAAW,EAAIiB,GAAG,EAAlB,CACD,CAFQ,CAEN,CAACjB,WAAD,CAFM,CAAT,CAIA,mBACE,KAAC,aAAD,wBACE,KAAC,MAAD,wBACE,KAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAEG,WAA7B,uBACE,MAAC,aAAD,CAAe,QAAf,EAAwB,KAAK,CAAED,aAA/B,WAEIF,WAAW,cAAG,KAAC,KAAD,EAAO,KAAK,KAAZ,CAAa,IAAI,CAAC,GAAlB,uBACZ,KAAC,QAAD,IADY,EAAH,CAEAoC,OAAO,CAACC,GAAR,EAJf,cAME,KAAC,KAAD,EACE,IAAI,CAAC,sBADP,CAEE,KAAK,KAFP,CAGE,MAAM,CAAE,gBAAAC,KAAK,qBAAI,KAAC,YAAD,kBAAkBA,KAAlB,EAAJ,EAHf,EANF,cAWE,KAAC,KAAD,EACE,IAAI,CAAC,eADP,CAEE,KAAK,KAFP,CAGE,MAAM,CAAE,gBAAAA,KAAK,qBAAI,KAAC,MAAD,kBAAYA,KAAZ,EAAJ,EAHf,EAXF,cAgBE,KAAC,KAAD,EACE,IAAI,CAAC,+BADP,CAEE,KAAK,KAFP,CAGE,MAAM,CAAE,gBAAAA,KAAK,qBAAI,KAAC,cAAD,kBAAoBA,KAApB,EAAJ,EAHf,EAhBF,cAqBE,KAAC,KAAD,EACE,IAAI,CAAC,OADP,CAEE,SAAS,CAAEzD,IAFb,EArBF,cAwBE,KAAC,KAAD,EACE,IAAI,CAAC,OADP,CAEE,SAAS,CAAEC,QAFb,EAxBF,cA2BE,KAAC,KAAD,EACE,IAAI,CAAC,SADP,CAEE,SAAS,CAAEC,UAFb,EA3BF,cA8BE,KAAC,KAAD,EACE,IAAI,CAAC,eADP,CAEE,MAAM,CAAE,gBAAAuD,KAAK,qBAAI,KAAC,WAAD,kBAAiBA,KAAjB,EAAJ,EAFf,EA9BF,cAkCE,KAAC,KAAD,EAAO,IAAI,CAAC,SAAZ,CACE,MAAM,CAAE,gBAAAA,KAAK,qBAAI,KAAC,MAAD,kBAAYA,KAAZ,EAAJ,EADf,EAlCF,cAqCE,KAAC,KAAD,EAAO,IAAI,CAAC,UAAZ,CACE,MAAM,CAAE,gBAAAA,KAAK,qBAAI,KAAC,WAAD,kBAAiBA,KAAjB,EAAJ,EADf,EArCF,GADF,EADF,EADF,EADF,CAiDD,CAED,cAAe7C,CAAAA,GAAf","sourcesContent":["import React, { useMemo, useState, useEffect } from 'react'\nimport './App.css';\nimport { useHistory } from 'react-router-dom';\nimport { BrowserRouter, Switch, Route } from \"react-router-dom\"\nimport ActivatePage from './component/loginComponent/activate';\nimport Forget from './component/loginComponent/forget';\nimport ChangePassword from './component/loginComponent/changePassword';\nimport HomePage from './component/HomePage';\nimport Chat from './component/chatComponent/chat';\nimport NewsMain from './component/newsComponents/newsMain';\nimport Main_block from './component/main.block';\nimport ViewOneBlog from './component/newsComponents/viewBlog/viewOneBlog';\nimport { Notifications, MessageList } from './userContext';\nimport axios from \"axios\"\nimport { getCookie } from './helpers/auth';\nimport socketApp from './socket';\nimport { toast } from \"react-toastify\"\nimport Policy from './component/anotherPage/policy';\nimport SuggestPage from './component/anotherPage/suggestPage';\n\n\nfunction App() {\n  let socket = socketApp.getSocket()\n  const id = getCookie().token\n  const [value, setValue] = useState([]);\n  const [listMessage, setListMessage] = useState(null)\n  const notifications = useMemo(() => ({ value, setValue }), [value, setValue]);\n  const messageList = useMemo(() => ({ listMessage, setListMessage }), [listMessage, setListMessage])\n  const [start, setStart] = useState(0);\n  const [end, setEnd] = useState(10);\n  const history = useHistory()\n\n\n  let forLoop = (arr, msgs) => {\n    for (let i = 0; i < arr.length; i++) {\n      if (arr[i].idRoom === msgs.idRoom && i !== 0) {\n        arr.splice(i, 1)\n        arr.unshift(msgs)\n        return setListMessage(arr)\n      }\n      else if (arr[i].idRoom === msgs.idRoom && i === 0) {\n        arr[0] = msgs\n        return setListMessage(arr)\n      }\n    }\n  }\n  let fnc = () => {\n    let arr = [...listMessage]\n    socket.once(\"message\", msgs => msgs.type === \"message\" && forLoop(arr, msgs))\n  }\n\n  useEffect(() => {\n    id && socket.emit(\"join\", { id })\n    socket.on(\"activities\", msg => toast.info(msg.number + msg.value))\n  }, [socket, id])\n\n  useEffect(() => {\n    axios.get(\"http://localhost:2704/api/news/notifications?id=\" + id + \"&start=0&end=10\")\n      .then(res => {\n        let fnc = () => {\n          for (let data of res.data.value) {\n            let arr = {\n              type: data.value,\n              value: data.type,\n              number: data.number\n            }\n            setValue(a => [...a, arr])\n          }\n        }\n        res.data.value !== undefined && fnc()\n      }).catch(err => { })\n\n    axios.post(\"http://localhost:2704/api/msgC/contactL?start=\" + start + \"&end=\" + end, { id })\n      .then(res => {\n        if (res.data.message) history.push(\"/report\")\n        else setListMessage(res.data)\n      }).catch(err => { })\n  }, [id])\n\n  useEffect(() => {\n    listMessage && fnc()\n  }, [listMessage])\n\n  return (\n    <BrowserRouter >\n      <Switch>\n        <MessageList.Provider value={messageList}>\n          <Notifications.Provider value={notifications}>\n            {\n              listMessage ? <Route exact path=\"/\" >\n                <HomePage />\n              </Route> : console.log()\n            }\n            <Route\n              path=\"/users/active/:token\"\n              exact\n              render={props => <ActivatePage {...props} />}\n            />\n            <Route\n              path=\"/users/forget\"\n              exact\n              render={props => <Forget {...props} />}\n            />\n            <Route\n              path=\"/users/password/forget/:token\"\n              exact\n              render={props => <ChangePassword {...props} />}\n            />\n            <Route\n              path=\"/chat\"\n              component={Chat} />\n            <Route\n              path=\"/news\"\n              component={NewsMain} />\n            <Route\n              path=\"/report\"\n              component={Main_block} />\n            <Route\n              path=\"/posts/id=:id\"\n              render={props => <ViewOneBlog {...props} />}\n            />\n            <Route path=\"/policy\"\n              render={props => <Policy {...props} />}\n            />\n            <Route path=\"/suggest\"\n              render={props => <SuggestPage {...props} />}\n            />\n          </Notifications.Provider>\n        </MessageList.Provider >\n      </Switch>\n    </BrowserRouter>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}