{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/dthai/sadness/a-client/src/App.js\",\n    _s = $RefreshSig$();\n\nimport React, { useMemo, useState, useEffect } from 'react';\nimport './App.css';\nimport { useHistory } from 'react-router-dom';\nimport { BrowserRouter, Switch, Route } from \"react-router-dom\";\nimport ActivatePage from './component/loginComponent/activate';\nimport Forget from './component/loginComponent/forget';\nimport ChangePassword from './component/loginComponent/changePassword';\nimport HomePage from './component/HomePage';\nimport Chat from './component/chatComponent/findChat';\nimport NewsMain from './component/newsComponents/newsMain';\nimport Main_block from './component/main.block';\nimport ViewOneBlog from './component/newsComponents/viewBlog/viewOneBlog';\nimport { Notifications, MessageList, PeerJS } from './userContext';\nimport axios from \"axios\";\nimport { getCookie } from './helpers/auth';\nimport socketApp from './socket';\nimport { toast } from \"react-toastify\";\nimport Policy from './component/anotherPage/policy';\nimport SuggestPage from './component/anotherPage/suggestPage';\nimport CreateShots from './component/anotherPage/createShot';\nimport AudioChatCom from './component/audioChatComponent/index';\nimport Peer from \"peerjs\";\nimport InRoom from \"./component/audioChatComponent/inRoom\";\n\nfunction App() {\n  _s();\n\n  let socket = socketApp.getSocket();\n  const id = getCookie().token;\n  const [value, setValue] = useState([]);\n  const [title, setTitle] = useState();\n  const [listMessage, setListMessage] = useState(null);\n  const notifications = useMemo(() => ({\n    value,\n    setValue\n  }), [value, setValue]);\n  const messageList = useMemo(() => ({\n    listMessage,\n    setListMessage\n  }), [listMessage, setListMessage]);\n  const [end, setEnd] = useState(10);\n  const history = useHistory();\n  const [peer, setPeer] = useState(null);\n  useEffect(() => {\n    let newNull = () => {\n      peer.destroy();\n    };\n\n    let createPeer = () => {\n      var peerJS = new Peer(id, {\n        host: \"/\",\n        port: 2704,\n        path: \"/peerjs\"\n      });\n      return peerJS;\n    };\n\n    peer && newNull();\n    let peerJS = createPeer();\n    peerJS && setPeer(peerJS); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [id]); // do not match two these useEffect \n  // This useEffect is use for recieve data from server\n\n  useEffect(() => {\n    let fncNotification = arrNoti => {\n      // if user has notifications now \n      socket.once(\"activities\", async msg => {\n        // value is link to post \n        toast.info(msg.number + msg.value);\n        let arr = {\n          type: msg.type,\n          value: msg.value,\n          number: msg.number\n        };\n        let i = 0;\n\n        for await (let data of arrNoti) {\n          // type (post,like,comment), value(link to that post)\n          if (data.type === arr.type && data.value === arr.value) {\n            let old = [...value];\n            old.splice(i, 1);\n            old.unshift(data);\n            return setValue(old);\n          }\n\n          i++;\n        }\n\n        setValue(a => [...a, arr]);\n      });\n    };\n\n    fncNotification(value);\n  }, [value, socket]); // fetch data\n\n  useEffect(() => {\n    // get notifications list\n    axios.get(\"http://localhost:2704/api/news/notifications?id=\" + id + \"&start=0&end=10\").then(res => {\n      let fnc = () => {\n        for (let data of res.data.value) {\n          let arr = {\n            type: data.value,\n            value: data.type,\n            number: data.number\n          };\n          setValue(a => [...a, arr]);\n        }\n      };\n\n      res.data.value !== undefined && fnc();\n    }).catch(err => {}); // get message list\n\n    axios.post(`http://localhost:2704/api/msgC/contactL?start=${end - 10}&end=${end}`, {\n      id\n    }).then(res => {\n      if (res.data.message) history.push(\"/report\");else setListMessage(res.data);\n    }).catch(err => {});\n  }, [id, end, history]);\n  useEffect(() => {\n    let changeTitle = (idMessage, arr) => {\n      if (idMessage !== id) setTitle(\"Bạn có 1 tin nhắn mới\");\n      return setListMessage(arr);\n    }; // check same value \n\n\n    let forLoop = (arr, msgs) => {\n      for (let i = 0; i < arr.length; i++) {\n        if (arr[i].idRoom === msgs.idRoom && i !== 0) {\n          arr.splice(i, 1);\n          arr.unshift(msgs);\n          return changeTitle(msgs.data.id, arr);\n        } else if (arr[i].idRoom === msgs.idRoom && i === 0) {\n          arr[0] = msgs;\n          return changeTitle(msgs.data.id, arr);\n        }\n      }\n    }; // recieve message once\n\n\n    let fnc = () => {\n      let arr = [...listMessage];\n      socket.once(\"message\", msgs => msgs.type === \"message\" && forLoop(arr, msgs));\n    };\n\n    socket.on(\"reqShot\", msg => {\n      let arr = listMessage ? [...listMessage] : [];\n      arr.push(msg.mess);\n      setListMessage(arr);\n    }) && listMessage && listMessage.length > 0 && fnc();\n  }, [listMessage, socket, id]);\n  useEffect(() => {// document.title = title\n  }, [title]);\n  useEffect(() => {\n    id && socket.emit(\"join\", {\n      id\n    });\n  }, [socket, id]);\n  return /*#__PURE__*/_jsxDEV(BrowserRouter, {\n    children: /*#__PURE__*/_jsxDEV(Switch, {\n      children: /*#__PURE__*/_jsxDEV(MessageList.Provider, {\n        value: messageList,\n        children: /*#__PURE__*/_jsxDEV(Notifications.Provider, {\n          value: notifications,\n          children: [/*#__PURE__*/_jsxDEV(PeerJS.Provider, {\n            value: peer,\n            children: [listMessage ? /*#__PURE__*/_jsxDEV(Route, {\n              exact: true,\n              path: \"/\",\n              children: /*#__PURE__*/_jsxDEV(HomePage, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 160,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 159,\n              columnNumber: 31\n            }, this) : console.log(), peer && /*#__PURE__*/_jsxDEV(Route, {\n              exact: true,\n              path: \"/podcast\",\n              render: props => /*#__PURE__*/_jsxDEV(InRoom, { ...props,\n                peer: peer\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 164,\n                columnNumber: 34\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 163,\n              columnNumber: 24\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/users/active/:token\",\n            exact: true,\n            render: props => /*#__PURE__*/_jsxDEV(ActivatePage, { ...props\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 171,\n              columnNumber: 32\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 168,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/users/forget\",\n            exact: true,\n            render: props => /*#__PURE__*/_jsxDEV(Forget, { ...props\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 176,\n              columnNumber: 32\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 173,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/users/password/forget/:token\",\n            exact: true,\n            render: props => /*#__PURE__*/_jsxDEV(ChangePassword, { ...props\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 181,\n              columnNumber: 32\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/chat\",\n            component: Chat\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/audio\",\n            component: AudioChatCom\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/news\",\n            component: NewsMain\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/report\",\n            component: Main_block\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/posts/id=:id\",\n            render: props => /*#__PURE__*/_jsxDEV(ViewOneBlog, { ...props\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 198,\n              columnNumber: 32\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/policy\",\n            render: props => /*#__PURE__*/_jsxDEV(Policy, { ...props\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 201,\n              columnNumber: 32\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/suggest\",\n            render: props => /*#__PURE__*/_jsxDEV(SuggestPage, { ...props\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 204,\n              columnNumber: 32\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 203,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/create/shots\",\n            render: props => /*#__PURE__*/_jsxDEV(CreateShots, { ...props\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 207,\n              columnNumber: 32\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 206,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 153,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"XfwXl9dSu6YcScxG0X0bfW3UcY4=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/home/dthai/sadness/a-client/src/App.js"],"names":["React","useMemo","useState","useEffect","useHistory","BrowserRouter","Switch","Route","ActivatePage","Forget","ChangePassword","HomePage","Chat","NewsMain","Main_block","ViewOneBlog","Notifications","MessageList","PeerJS","axios","getCookie","socketApp","toast","Policy","SuggestPage","CreateShots","AudioChatCom","Peer","InRoom","App","socket","getSocket","id","token","value","setValue","title","setTitle","listMessage","setListMessage","notifications","messageList","end","setEnd","history","peer","setPeer","newNull","destroy","createPeer","peerJS","host","port","path","fncNotification","arrNoti","once","msg","info","number","arr","type","i","data","old","splice","unshift","a","get","then","res","fnc","undefined","catch","err","post","message","push","changeTitle","idMessage","forLoop","msgs","length","idRoom","on","mess","emit","console","log","props"],"mappings":"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","sourcesContent":["import React, { useMemo, useState, useEffect } from 'react'\nimport './App.css';\nimport { useHistory } from 'react-router-dom';\nimport { BrowserRouter, Switch, Route } from \"react-router-dom\"\nimport ActivatePage from './component/loginComponent/activate';\nimport Forget from './component/loginComponent/forget';\nimport ChangePassword from './component/loginComponent/changePassword';\nimport HomePage from './component/HomePage';\nimport Chat from './component/chatComponent/findChat';\nimport NewsMain from './component/newsComponents/newsMain';\nimport Main_block from './component/main.block';\nimport ViewOneBlog from './component/newsComponents/viewBlog/viewOneBlog';\nimport { Notifications, MessageList, PeerJS } from './userContext';\nimport axios from \"axios\"\nimport { getCookie } from './helpers/auth';\nimport socketApp from './socket';\nimport { toast } from \"react-toastify\"\nimport Policy from './component/anotherPage/policy';\nimport SuggestPage from './component/anotherPage/suggestPage';\nimport CreateShots from './component/anotherPage/createShot';\nimport AudioChatCom from './component/audioChatComponent/index';\nimport Peer from \"peerjs\"\nimport InRoom from \"./component/audioChatComponent/inRoom\"\n\nfunction App() {\n  let socket = socketApp.getSocket()\n  const id = getCookie().token\n  const [value, setValue] = useState([]);\n  const [title, setTitle] = useState()\n  const [listMessage, setListMessage] = useState(null)\n  const notifications = useMemo(() => ({ value, setValue }), [value, setValue]);\n  const messageList = useMemo(() => ({ listMessage, setListMessage }), [listMessage, setListMessage])\n  const [end, setEnd] = useState(10);\n  const history = useHistory()\n  const [peer, setPeer] = useState(null)\n\n\n  useEffect(() => {\n    let newNull = () => {\n      peer.destroy()\n    }\n    let createPeer = () => {\n      var peerJS = new Peer(id, {\n        host: \"/\",\n        port: 2704,\n        path: \"/peerjs\"\n      })\n      return peerJS\n    }\n    peer && newNull()\n    let peerJS = createPeer()\n    peerJS && setPeer(peerJS)\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [id])\n\n  // do not match two these useEffect \n  // This useEffect is use for recieve data from server\n  useEffect(() => {\n    let fncNotification = (arrNoti) => {\n      // if user has notifications now \n      socket.once(\"activities\", async (msg) => {\n        // value is link to post \n        toast.info(msg.number + msg.value)\n        let arr = { type: msg.type, value: msg.value, number: msg.number }\n        let i = 0\n        for await (let data of arrNoti) {\n          // type (post,like,comment), value(link to that post)\n          if (data.type === arr.type && data.value === arr.value) {\n            let old = [...value]\n            old.splice(i, 1)\n            old.unshift(data)\n            return setValue(old)\n          }\n          i++\n        }\n        setValue(a => [...a, arr])\n      })\n    }\n    fncNotification(value)\n  }, [value, socket])\n\n  // fetch data\n  useEffect(() => {\n    // get notifications list\n    axios.get(\"http://localhost:2704/api/news/notifications?id=\" + id + \"&start=0&end=10\")\n      .then(res => {\n        let fnc = () => {\n          for (let data of res.data.value) {\n            let arr = {\n              type: data.value,\n              value: data.type,\n              number: data.number\n            }\n            setValue(a => [...a, arr])\n          }\n        }\n        res.data.value !== undefined && fnc()\n      }).catch(err => { })\n\n    // get message list\n    axios.post(`http://localhost:2704/api/msgC/contactL?start=${end - 10}&end=${end}`, { id })\n      .then(res => {\n        if (res.data.message) history.push(\"/report\")\n        else setListMessage(res.data)\n      }).catch(err => { })\n\n  }, [id, end, history])\n\n  useEffect(() => {\n\n    let changeTitle = (idMessage, arr) => {\n      if (idMessage !== id) setTitle(\"Bạn có 1 tin nhắn mới\")\n      return setListMessage(arr)\n    }\n\n    // check same value \n    let forLoop = (arr, msgs) => {\n      for (let i = 0; i < arr.length; i++) {\n        if (arr[i].idRoom === msgs.idRoom && i !== 0) {\n          arr.splice(i, 1)\n          arr.unshift(msgs)\n          return changeTitle(msgs.data.id, arr)\n        }\n        else if (arr[i].idRoom === msgs.idRoom && i === 0) {\n          arr[0] = msgs\n          return changeTitle(msgs.data.id, arr)\n        }\n      }\n    }\n    // recieve message once\n    let fnc = () => {\n      let arr = [...listMessage]\n      socket.once(\"message\", msgs => msgs.type === \"message\" && forLoop(arr, msgs))\n    }\n\n    socket.on(\"reqShot\", msg => {\n      let arr = listMessage ? [...listMessage] : []\n      arr.push(msg.mess)\n      setListMessage(arr)\n    }) && listMessage && listMessage.length > 0 && fnc()\n  }, [listMessage, socket, id])\n\n  useEffect(() => {\n    // document.title = title\n  }, [title])\n\n  useEffect(() => {\n    id && socket.emit(\"join\", { id })\n  }, [socket, id])\n\n  return (\n    <BrowserRouter >\n      <Switch>\n        <MessageList.Provider value={messageList}>\n          <Notifications.Provider value={notifications}>\n            <PeerJS.Provider value={peer}>\n              {\n                listMessage ? <Route exact path=\"/\" >\n                  <HomePage />\n                </Route> : console.log()\n              }\n              {peer && <Route exact path=\"/podcast\"\n                render={props => <InRoom {...props} peer={peer} />}\n              />}\n            </PeerJS.Provider>\n\n            <Route\n              path=\"/users/active/:token\"\n              exact\n              render={props => <ActivatePage {...props} />}\n            />\n            <Route\n              path=\"/users/forget\"\n              exact\n              render={props => <Forget {...props} />}\n            />\n            <Route\n              path=\"/users/password/forget/:token\"\n              exact\n              render={props => <ChangePassword {...props} />}\n            />\n            <Route\n              path=\"/chat\"\n              component={Chat} />\n            <Route\n              path=\"/audio\"\n              component={AudioChatCom}\n            />\n            <Route\n              path=\"/news\"\n              component={NewsMain} />\n            <Route\n              path=\"/report\"\n              component={Main_block} />\n            <Route\n              path=\"/posts/id=:id\"\n              render={props => <ViewOneBlog {...props} />}\n            />\n            <Route path=\"/policy\"\n              render={props => <Policy {...props} />}\n            />\n            <Route path=\"/suggest\"\n              render={props => <SuggestPage {...props} />}\n            />\n            <Route path=\"/create/shots\"\n              render={props => <CreateShots {...props} />}\n            />\n          </Notifications.Provider>\n        </MessageList.Provider >\n      </Switch>\n    </BrowserRouter>\n  );\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}