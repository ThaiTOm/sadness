{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/duythai/Developer/sadness/a-client/src/component/chatComponent/chat.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState, useRef } from 'react';\nimport classNames from 'classnames';\nimport { getCookie, encryptTo, decryptWithAES } from '../../helpers/auth';\nimport SendOutlinedIcon from '@material-ui/icons/SendOutlined';\nimport axios from \"axios\";\nimport socketApp from '../../socket';\nimport ImageIcon from '@material-ui/icons/Image';\nimport IconButton from '@material-ui/core/IconButton';\nimport { handleFileUpload, messageLiRender, messageLiImageRender, executeScroll, spinning } from '../../helpers/message';\nconsole.log(spinning);\n\nfunction Chat() {\n  _s();\n\n  let socket = socketApp.getSocket();\n  const id = getCookie().token;\n  const ipOfUser = \"Dong nai\";\n  const [value, setValue] = useState([]); // len is len of rooms the user had join\n\n  const [len, SetLen] = useState(0);\n  const fileRef = useRef(null); //This id room contain every id of the message that they have\n  // waitG = wait group\n\n  const [waitG, setWaitG] = useState(null);\n  const [message, setMessage] = useState(\"\");\n  const [idRoom, setidRoom] = useState(\"\");\n  const [wait, setWait] = useState(false);\n  const [finish, setFinish] = useState(false);\n  const myRef = useRef(null);\n\n  const useRefTrigger = () => {\n    fileRef.current.click();\n  };\n\n  const HanldeClickFind = e => {\n    if (wait !== true) {\n      socket.emit(\"joinChat\", {\n        id,\n        len,\n        ipOfUser\n      }, error => {\n        if (error === \"error\") {\n          setWait(true);\n        } else {\n          setFinish(true);\n          setidRoom(error);\n        }\n      });\n    } else {\n      setWait(false);\n      socket.emit(\"joinChat\", {\n        id,\n        len,\n        ipOfUser\n      }, error => {\n        if (error !== \"error\") {\n          setFinish(true);\n          setidRoom(error);\n        }\n      });\n    }\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n\n    if (message) {\n      let value = encryptTo(message);\n      socket.emit('sendMessage', {\n        room: idRoom,\n        message: value,\n        id\n      }, () => setMessage(\"\"));\n    }\n  }; //Fetch data to recive the idRoom\n\n\n  useEffect(() => {\n    const source = axios.CancelToken.source();\n\n    const fetchData = async () => {\n      try {\n        await axios.post(\"http://localhost:2704/api/msgC/getIdRoom\", {\n          id\n        }).then(res => {\n          SetLen(res.data.len);\n        });\n      } catch (error) {}\n    };\n\n    fetchData();\n    return () => {\n      source.cancel();\n    };\n  }, [id]); //load message\n\n  useEffect(() => {\n    socket.on(\"message\", msg => {\n      if (msg.roomId) {\n        // If we have a couple together than we start to chat\n        setWait(false);\n        setFinish(true);\n        setidRoom(msg.roomId);\n      }\n\n      if (msg.image) {\n        // if message send is image\n        setValue(img => [...img, msg.image + \";\" + msg.user]);\n      } else if (msg.text) {\n        setValue(msgs => [...msgs, msg.text + \",\" + msg.user]);\n        executeScroll(myRef);\n      }\n    });\n  }, [socket]); //defined button find partner classname\n\n  var btnClassFind = classNames({\n    \"onclic\": wait\n  });\n\n  const changeStateWaitGroup = () => {\n    if (waitG === null) {\n      setWaitG(\"active\");\n      socket.emit(\"joinChatGroup\", {\n        id,\n        len,\n        ipOfUser\n      }, callback => {\n        if (callback !== \"error\") {\n          setFinish(true);\n          setidRoom(callback);\n        }\n      });\n    } else {\n      setWaitG(null);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"message_container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container_button\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"part_1\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          style: finish === true ? {\n            display: \"none\"\n          } : {},\n          id: \"button_find_partner\",\n          className: btnClassFind,\n          onClick: HanldeClickFind,\n          children: wait === true ? {\n            spinning\n          } : \"Tìm cặp\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: finish === true ? {\n          display: \"none\"\n        } : {},\n        className: \"part_2\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: changeStateWaitGroup,\n          className: \"chat_button_group \" + waitG,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat_button_group\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"background\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 132,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n              className: \"chat-bubble\",\n              width: \"100\",\n              height: \"100\",\n              viewBox: \"0 0 100 100\",\n              children: [/*#__PURE__*/_jsxDEV(\"g\", {\n                className: \"bubble\",\n                children: [/*#__PURE__*/_jsxDEV(\"path\", {\n                  className: \"line line1\",\n                  d: \"M 30.7873,85.113394 30.7873,46.556405 C 30.7873,41.101961 36.826342,35.342 40.898074,35.342 H 59.113981 C 63.73287,35.342 69.29995,40.103201 69.29995,46.784744\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 135,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                  className: \"line line2\",\n                  d: \"M 13.461999,65.039335 H 58.028684 C 63.483128,65.039335 69.243089,59.000293 69.243089,54.928561 V 45.605853 C 69.243089,40.986964 65.02087,35.419884 58.339327,35.419884\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 138,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 134,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n                className: \"circle circle1\",\n                r: \"1.9\",\n                cy: \"50.7\",\n                cx: \"42.5\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 143,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n                className: \"circle circle2\",\n                cx: \"49.9\",\n                cy: \"50.7\",\n                r: \"1.9\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 144,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n                className: \"circle circle3\",\n                r: \"1.9\",\n                cy: \"50.7\",\n                cx: \"57.3\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 145,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 133,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n      style: finish === false ? {\n        display: \"none\"\n      } : {},\n      children: Object.values(value).map(function (item, i) {\n        let arr = item.split(\",\");\n\n        if (arr[0] === \"image\") {\n          // get image url\n          let imgUrl = arr[1] + \",\" + arr[2].split(\";\")[0]; // check if message is current user\n\n          if (arr[2].split(\";\")[1] === id) return messageLiImageRender(\"mIOwn\", i, imgUrl);else return messageLiImageRender(\"mIOther\", i, imgUrl);\n        } else {\n          // encrypt the message \n          let msgs = decryptWithAES(arr[0]);\n          if (arr[1] === id) return messageLiRender(\"messageLiOwn\", \"own_message_same_div messageLiOwnm60\", \"own_message_same_div messageLiOwnl60\", msgs, i);else return messageLiRender(\"messageLiOther\", \"other_message_same_div messageLiOtherm60\", \"other_message_same_div messageLiOtherl60\", msgs, i);\n        }\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      className: \"formMessage\",\n      style: finish === false ? {\n        display: \"none\"\n      } : {},\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"input\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          value: message,\n          onChange: e => setMessage(e.target.value),\n          type: \"text\",\n          placeholder: \"Enter text\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"extension_input\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          id: \"icon_button_file\",\n          type: \"file\",\n          onChange: e => handleFileUpload(e, id, idRoom),\n          ref: fileRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"inner_title\",\n          children: [/*#__PURE__*/_jsxDEV(IconButton, {\n            className: \"image_upload_message_icon\",\n            onClick: useRefTrigger,\n            children: /*#__PURE__*/_jsxDEV(ImageIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 195,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 194,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"title\",\n            id: \"image_upload_message_title\",\n            children: \"\\u0110\\u0103ng t\\u1EA3i \\u1EA3nh\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 197,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        children: /*#__PURE__*/_jsxDEV(SendOutlinedIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 115,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Chat, \"BHMrrfuArOuN9aCz4rQUEdcL9gs=\");\n\n_c = Chat;\nexport default Chat;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"sources":["/home/duythai/Developer/sadness/a-client/src/component/chatComponent/chat.js"],"names":["React","useEffect","useState","useRef","classNames","getCookie","encryptTo","decryptWithAES","SendOutlinedIcon","axios","socketApp","ImageIcon","IconButton","handleFileUpload","messageLiRender","messageLiImageRender","executeScroll","spinning","console","log","Chat","socket","getSocket","id","token","ipOfUser","value","setValue","len","SetLen","fileRef","waitG","setWaitG","message","setMessage","idRoom","setidRoom","wait","setWait","finish","setFinish","myRef","useRefTrigger","current","click","HanldeClickFind","e","emit","error","handleSubmit","preventDefault","room","source","CancelToken","fetchData","post","then","res","data","cancel","on","msg","roomId","image","img","user","text","msgs","btnClassFind","changeStateWaitGroup","callback","display","Object","values","map","item","i","arr","split","imgUrl","target"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\nimport classNames from 'classnames';\nimport { getCookie, encryptTo, decryptWithAES } from '../../helpers/auth';\nimport SendOutlinedIcon from '@material-ui/icons/SendOutlined';\nimport axios from \"axios\"\nimport socketApp from '../../socket';\nimport ImageIcon from '@material-ui/icons/Image';\nimport IconButton from '@material-ui/core/IconButton';\nimport { handleFileUpload, messageLiRender, messageLiImageRender, executeScroll, spinning } from '../../helpers/message';\nconsole.log(spinning)\nfunction Chat() {\n    let socket = socketApp.getSocket();\n    const id = getCookie().token;\n    const ipOfUser = \"Dong nai\";\n    const [value, setValue] = useState([]);\n    // len is len of rooms the user had join\n    const [len, SetLen] = useState(0);\n    const fileRef = useRef(null)\n    //This id room contain every id of the message that they have\n    // waitG = wait group\n    const [waitG, setWaitG] = useState(null);\n    const [message, setMessage] = useState(\"\");\n    const [idRoom, setidRoom] = useState(\"\");\n    const [wait, setWait] = useState(false);\n    const [finish, setFinish] = useState(false);\n    const myRef = useRef(null)\n\n    const useRefTrigger = () => {\n        fileRef.current.click()\n    }\n\n    const HanldeClickFind = (e) => {\n        if (wait !== true) {\n            socket.emit(\"joinChat\", { id, len, ipOfUser }, (error) => {\n                if (error === \"error\") {\n                    setWait(true)\n                } else {\n                    setFinish(true)\n                    setidRoom(error)\n                }\n            })\n        } else {\n            setWait(false)\n            socket.emit(\"joinChat\", { id, len, ipOfUser }, (error) => {\n                if (error !== \"error\") {\n                    setFinish(true)\n                    setidRoom(error)\n                }\n            })\n        }\n    }\n\n    const handleSubmit = (e) => {\n        e.preventDefault();\n        if (message) {\n            let value = encryptTo(message)\n            socket.emit('sendMessage', { room: idRoom, message: value, id }, () => setMessage(\"\"));\n        }\n    }\n    //Fetch data to recive the idRoom\n    useEffect(() => {\n        const source = axios.CancelToken.source()\n        const fetchData = async () => {\n            try {\n                await axios.post(\"http://localhost:2704/api/msgC/getIdRoom\", { id })\n                    .then(res => {\n                        SetLen(res.data.len)\n                    })\n            } catch (error) {\n            }\n        }\n        fetchData()\n        return () => {\n            source.cancel()\n        }\n    }, [id])\n    //load message\n    useEffect(() => {\n        socket.on(\"message\", msg => {\n            if (msg.roomId) {\n                // If we have a couple together than we start to chat\n                setWait(false)\n                setFinish(true)\n                setidRoom(msg.roomId)\n            }\n            if (msg.image) {\n                // if message send is image\n                setValue(img => [...img, msg.image + \";\" + msg.user])\n            }\n            else if (msg.text) {\n                setValue(msgs => [...msgs, msg.text + \",\" + msg.user])\n                executeScroll(myRef)\n            }\n        })\n    }, [socket])\n    //defined button find partner classname\n    var btnClassFind = classNames({\n        \"onclic\": wait,\n    })\n    const changeStateWaitGroup = () => {\n        if (waitG === null) {\n            setWaitG(\"active\")\n            socket.emit(\"joinChatGroup\", { id, len, ipOfUser }, (callback) => {\n                if (callback !== \"error\") {\n                    setFinish(true)\n                    setidRoom(callback)\n                }\n            })\n        }\n        else {\n            setWaitG(null)\n        }\n    }\n    return (\n        <div className=\"message_container\">\n            <div className=\"container_button\">\n                <div className=\"part_1\">\n                    <button\n                        style={finish === true ? { display: \"none\" } : {}}\n                        id=\"button_find_partner\"\n                        className={btnClassFind}\n                        onClick={HanldeClickFind}\n                    >\n                        {wait === true ? { spinning } : \"Tìm cặp\"}\n                    </button>\n                </div>\n                <div\n                    style={finish === true ? { display: \"none\" } : {}}\n                    className=\"part_2\">\n                    <div onClick={changeStateWaitGroup} className={\"chat_button_group \" + waitG}>\n                        <div className=\"chat_button_group\" >\n                            <div className=\"background\"></div>\n                            <svg className=\"chat-bubble\" width=\"100\" height=\"100\" viewBox=\"0 0 100 100\">\n                                <g className=\"bubble\">\n                                    <path className=\"line line1\" d=\"M 30.7873,85.113394 30.7873,46.556405 C 30.7873,41.101961\n          36.826342,35.342 40.898074,35.342 H 59.113981 C 63.73287,35.342\n          69.29995,40.103201 69.29995,46.784744\" />\n                                    <path className=\"line line2\" d=\"M 13.461999,65.039335 H 58.028684 C\n            63.483128,65.039335\n            69.243089,59.000293 69.243089,54.928561 V 45.605853 C\n            69.243089,40.986964 65.02087,35.419884 58.339327,35.419884\" />\n                                </g>\n                                <circle className=\"circle circle1\" r=\"1.9\" cy=\"50.7\" cx=\"42.5\" />\n                                <circle className=\"circle circle2\" cx=\"49.9\" cy=\"50.7\" r=\"1.9\" />\n                                <circle className=\"circle circle3\" r=\"1.9\" cy=\"50.7\" cx=\"57.3\" />\n                            </svg>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n            <ul\n                style={finish === false ? { display: \"none\" } : {}}>\n                {\n                    Object.values(value).map(function (item, i) {\n                        let arr = item.split(\",\")\n                        if (arr[0] === \"image\") {\n                            // get image url\n                            let imgUrl = arr[1] + \",\" + arr[2].split(\";\")[0]\n                            // check if message is current user\n                            if (arr[2].split(\";\")[1] === id) return messageLiImageRender(\"mIOwn\", i, imgUrl)\n                            else return messageLiImageRender(\"mIOther\", i, imgUrl)\n                        } else {\n                            // encrypt the message \n                            let msgs = decryptWithAES(arr[0])\n                            if (arr[1] === id) return messageLiRender(\"messageLiOwn\", \"own_message_same_div messageLiOwnm60\", \"own_message_same_div messageLiOwnl60\", msgs, i)\n                            else return messageLiRender(\"messageLiOther\", \"other_message_same_div messageLiOtherm60\", \"other_message_same_div messageLiOtherl60\", msgs, i)\n                        }\n                    })\n                }\n            </ul>\n            <form\n                className=\"formMessage\"\n                style={finish === false ? { display: \"none\" } : {}}\n                onSubmit={handleSubmit}>\n                <span className=\"input\">\n                    <input\n                        value={message}\n                        onChange={(e) => setMessage(e.target.value)}\n                        type=\"text\"\n                        placeholder=\"Enter text\" >\n                    </input>\n                    <span></span>\n                </span>\n                <div className=\"extension_input\">\n                    <input\n                        id=\"icon_button_file\"\n                        type=\"file\"\n                        onChange={(e) => handleFileUpload(e, id, idRoom)}\n                        ref={fileRef}\n\n                    />\n                    <div className=\"inner_title\">\n                        <IconButton className=\"image_upload_message_icon\" onClick={useRefTrigger}>\n                            <ImageIcon />\n                        </IconButton>\n                        <span className=\"title\" id=\"image_upload_message_title\">\n                            Đăng tải ảnh\n                    </span>\n                    </div>\n                </div>\n                <button type=\"submit\">\n                    <SendOutlinedIcon />\n                </button>\n            </form>\n        </div>\n    )\n}\n\nexport default Chat\n"]},"metadata":{},"sourceType":"module"}